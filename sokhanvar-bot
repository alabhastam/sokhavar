{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/aabdollahii/sokhanvar-pt2?scriptVersionId=276004850\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"code","execution_count":1,"id":"34fdf57f","metadata":{"execution":{"iopub.execute_input":"2025-11-11T13:14:13.899683Z","iopub.status.busy":"2025-11-11T13:14:13.899369Z","iopub.status.idle":"2025-11-11T13:14:16.206346Z","shell.execute_reply":"2025-11-11T13:14:16.205397Z"},"papermill":{"duration":2.312718,"end_time":"2025-11-11T13:14:16.208159","exception":false,"start_time":"2025-11-11T13:14:13.895441","status":"completed"},"tags":[]},"outputs":[],"source":["import pandas as pd\n","import os\n","\n","\n","molana_file_path = '/kaggle/input/molana-poems-csv/.csv' # <-- CHECK THIS FILENAME\n","saadi_file_path = '/kaggle/input/saadi-poems-csv/(1).csv'\n","\n","molana_df = pd.read_csv(molana_file_path)\n","saadi_df = pd.read_csv(saadi_file_path)\n"]},{"cell_type":"code","execution_count":2,"id":"3699f8fc","metadata":{"execution":{"iopub.execute_input":"2025-11-11T13:14:16.214304Z","iopub.status.busy":"2025-11-11T13:14:16.21355Z","iopub.status.idle":"2025-11-11T13:14:16.228666Z","shell.execute_reply":"2025-11-11T13:14:16.227669Z"},"papermill":{"duration":0.019414,"end_time":"2025-11-11T13:14:16.23009","exception":false,"start_time":"2025-11-11T13:14:16.210676","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["âœ… Successfully combined both datasets.\n","Original column order: ['misra1', 'misra2', 'poet']\n"]}],"source":["# add a new column to combine all the poets together\n","\n","molana_df['poet'] = 'Mowlana'\n","saadi_df['poet'] = 'Saadi'\n","\n","all_poems_df = pd.concat([molana_df, saadi_df], ignore_index=True)\n","print(\"âœ… Successfully combined both datasets.\")\n","print(\"Original column order:\", all_poems_df.columns.tolist())"]},{"cell_type":"code","execution_count":3,"id":"d63234e1","metadata":{"execution":{"iopub.execute_input":"2025-11-11T13:14:16.235736Z","iopub.status.busy":"2025-11-11T13:14:16.234994Z","iopub.status.idle":"2025-11-11T13:14:16.256341Z","shell.execute_reply":"2025-11-11T13:14:16.255486Z"},"papermill":{"duration":0.025423,"end_time":"2025-11-11T13:14:16.257665","exception":false,"start_time":"2025-11-11T13:14:16.232242","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>misra1</th>\n","      <th>misra2</th>\n","      <th>poet</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>ÛŒÚ©ÛŒ Ú¯Ù†Ø¬ÛŒ Ù¾Ø¯ÛŒØ¯ Ø¢Ù…Ø¯ Ø¯Ø± Ø¢Ù† Ø¯Ú©Ø§Ù† Ø²Ø±Ú©ÙˆØ¨ÛŒ</td>\n","      <td>Ø²Ù‡ÛŒ ØµÙˆØ±Øª Ø²Ù‡ÛŒ Ù…Ø¹Ù†ÛŒ Ø²Ù‡ÛŒ Ø®ÙˆØ¨ÛŒ Ø²Ù‡ÛŒ Ø®ÙˆØ¨ÛŒ</td>\n","      <td>Mowlana</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>Ø²Ù‡ÛŒ Ø¨Ø§Ø²Ø§Ø± Ø²Ø±Ú©ÙˆØ¨Ø§Ù† Ø²Ù‡ÛŒ Ø§Ø³Ø±Ø§Ø± ÛŒØ¹Ù‚ÙˆØ¨Ø§Ù†</td>\n","      <td>Ú©Ù‡ Ø¬Ø§Ù† ÛŒÙˆØ³Ù Ø§Ø² Ø¹Ø´Ù‚Ø´ Ø¨Ø±Ø¢Ø±Ø¯ Ø´ÙˆØ± ÛŒØ¹Ù‚ÙˆØ¨ÛŒ</td>\n","      <td>Mowlana</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>Ø² Ø¹Ø´Ù‚ Ø§Ùˆ Ø¯Ùˆ ØµØ¯ Ù„ÛŒÙ„ÛŒ Ú†Ùˆ Ù…Ø¬Ù†ÙˆÙ† Ø¨Ù†Ø¯ Ù…ÛŒâ€ŒØ¯Ø±Ø¯</td>\n","      <td>Ú©Ø² Ø§ÛŒÙ† Ø¢ØªØ´ Ø²Ø¨ÙˆÙ† Ø¢ÛŒØ¯ ØµØ¨ÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙˆØ¨ÛŒ</td>\n","      <td>Mowlana</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>Ø´Ø¯Ù‡ Ø²Ø±Ú©ÙˆØ¨ Ùˆ Ø­Ù‚ Ù…Ø§Ù†Ø¯Ù‡ ØªÙ†Ø´ Ú†ÙˆÙ† Ø²Ø±ÙˆØ±Ù‚ Ù…Ø§Ù†Ø¯Ù‡</td>\n","      <td>Ø¬ÙˆØ§Ù‡Ø± Ø¨Ø± Ø·Ø¨Ù‚ Ù…Ø§Ù†Ø¯Ù‡ Ú†Ùˆ Ø²Ø±Ú©ÙˆØ¨ÛŒ Ú©Ø±ÙˆØ¨ÛŒ</td>\n","      <td>Mowlana</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>Ø¨ÛŒØ§ Ø¨Ù†ÙˆØ§Ø² Ø¹Ø§Ø´Ù‚ Ø±Ø§ Ú©Ù‡ ØªÙˆ Ø¬Ø§Ù†ÛŒ Ø­Ù‚Ø§ÛŒÙ‚ Ø±Ø§</td>\n","      <td>Ø¨Ø²Ù† Ú¯Ø±Ø¯Ù† Ù…Ù†Ø§ÙÙ‚ Ø±Ø§ Ø§Ú¯Ø± Ø§Ø² ÙˆÛŒ Ø¨ÛŒØ§Ø´ÙˆØ¨ÛŒ</td>\n","      <td>Mowlana</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                                     misra1  \\\n","0       ÛŒÚ©ÛŒ Ú¯Ù†Ø¬ÛŒ Ù¾Ø¯ÛŒØ¯ Ø¢Ù…Ø¯ Ø¯Ø± Ø¢Ù† Ø¯Ú©Ø§Ù† Ø²Ø±Ú©ÙˆØ¨ÛŒ   \n","1       Ø²Ù‡ÛŒ Ø¨Ø§Ø²Ø§Ø± Ø²Ø±Ú©ÙˆØ¨Ø§Ù† Ø²Ù‡ÛŒ Ø§Ø³Ø±Ø§Ø± ÛŒØ¹Ù‚ÙˆØ¨Ø§Ù†   \n","2   Ø² Ø¹Ø´Ù‚ Ø§Ùˆ Ø¯Ùˆ ØµØ¯ Ù„ÛŒÙ„ÛŒ Ú†Ùˆ Ù…Ø¬Ù†ÙˆÙ† Ø¨Ù†Ø¯ Ù…ÛŒâ€ŒØ¯Ø±Ø¯   \n","3  Ø´Ø¯Ù‡ Ø²Ø±Ú©ÙˆØ¨ Ùˆ Ø­Ù‚ Ù…Ø§Ù†Ø¯Ù‡ ØªÙ†Ø´ Ú†ÙˆÙ† Ø²Ø±ÙˆØ±Ù‚ Ù…Ø§Ù†Ø¯Ù‡   \n","4     Ø¨ÛŒØ§ Ø¨Ù†ÙˆØ§Ø² Ø¹Ø§Ø´Ù‚ Ø±Ø§ Ú©Ù‡ ØªÙˆ Ø¬Ø§Ù†ÛŒ Ø­Ù‚Ø§ÛŒÙ‚ Ø±Ø§   \n","\n","                                 misra2     poet  \n","0   Ø²Ù‡ÛŒ ØµÙˆØ±Øª Ø²Ù‡ÛŒ Ù…Ø¹Ù†ÛŒ Ø²Ù‡ÛŒ Ø®ÙˆØ¨ÛŒ Ø²Ù‡ÛŒ Ø®ÙˆØ¨ÛŒ  Mowlana  \n","1  Ú©Ù‡ Ø¬Ø§Ù† ÛŒÙˆØ³Ù Ø§Ø² Ø¹Ø´Ù‚Ø´ Ø¨Ø±Ø¢Ø±Ø¯ Ø´ÙˆØ± ÛŒØ¹Ù‚ÙˆØ¨ÛŒ  Mowlana  \n","2   Ú©Ø² Ø§ÛŒÙ† Ø¢ØªØ´ Ø²Ø¨ÙˆÙ† Ø¢ÛŒØ¯ ØµØ¨ÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙˆØ¨ÛŒ  Mowlana  \n","3    Ø¬ÙˆØ§Ù‡Ø± Ø¨Ø± Ø·Ø¨Ù‚ Ù…Ø§Ù†Ø¯Ù‡ Ú†Ùˆ Ø²Ø±Ú©ÙˆØ¨ÛŒ Ú©Ø±ÙˆØ¨ÛŒ  Mowlana  \n","4   Ø¨Ø²Ù† Ú¯Ø±Ø¯Ù† Ù…Ù†Ø§ÙÙ‚ Ø±Ø§ Ø§Ú¯Ø± Ø§Ø² ÙˆÛŒ Ø¨ÛŒØ§Ø´ÙˆØ¨ÛŒ  Mowlana  "]},"execution_count":3,"metadata":{},"output_type":"execute_result"}],"source":["all_poems_df.head()"]},{"cell_type":"code","execution_count":4,"id":"c2c0bda8","metadata":{"execution":{"iopub.execute_input":"2025-11-11T13:14:16.263502Z","iopub.status.busy":"2025-11-11T13:14:16.263232Z","iopub.status.idle":"2025-11-11T13:14:16.302462Z","shell.execute_reply":"2025-11-11T13:14:16.301465Z"},"papermill":{"duration":0.043804,"end_time":"2025-11-11T13:14:16.303873","exception":false,"start_time":"2025-11-11T13:14:16.260069","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["<class 'pandas.core.frame.DataFrame'>\n","RangeIndex: 82194 entries, 0 to 82193\n","Data columns (total 3 columns):\n"," #   Column  Non-Null Count  Dtype \n","---  ------  --------------  ----- \n"," 0   misra1  82194 non-null  object\n"," 1   misra2  82194 non-null  object\n"," 2   poet    82194 non-null  object\n","dtypes: object(3)\n","memory usage: 1.9+ MB\n"]}],"source":["all_poems_df.info()"]},{"cell_type":"code","execution_count":5,"id":"faaebb0e","metadata":{"execution":{"iopub.execute_input":"2025-11-11T13:14:16.310506Z","iopub.status.busy":"2025-11-11T13:14:16.309776Z","iopub.status.idle":"2025-11-11T13:14:16.316932Z","shell.execute_reply":"2025-11-11T13:14:16.316213Z"},"papermill":{"duration":0.012006,"end_time":"2025-11-11T13:14:16.318425","exception":false,"start_time":"2025-11-11T13:14:16.306419","status":"completed"},"tags":[]},"outputs":[],"source":["import re\n","import random\n","\n","# words are already normalized \n","def find_reply_poem(user_input: str, poems_df: pd.DataFrame, text_column: str) -> str:\n","    \n","    \n","\n","    # Find the last valid Persian letter of the user's input\n","    last_letter = None\n","    for char in reversed(user_input):\n","        if re.match('[Ø¢-ÛŒ]', char):\n","            last_letter = char\n","            break # Stop as soon as we find the first valid letter from the end\n","\n","    if last_letter is None:\n","        return \"Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ø­Ø±Ù Ù…Ù†Ø§Ø³Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¹Ø± Ø¨Ø¹Ø¯ÛŒ Ø¯Ø± Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ù¾ÛŒØ¯Ø§ Ù†Ú©Ø±Ø¯Ù…. Ù„Ø·ÙØ§ ÛŒÚ© Ø¨ÛŒØª Ø´Ø¹Ø± Ø¨ÙØ±Ø³ØªÛŒØ¯.\"\n","\n","    print(f\"DEBUG: User's last letter is '{last_letter}'. Searching for a reply...\")\n","\n","    # Build the regex pattern to find a poem starting with that letter\n","    #    ^ means \"start of the string\"\n","    regex_pattern = f\"^{last_letter}\"\n","\n","    # .str.contains() with regex=True is a powerful way to apply regex to a pandas column\n","    # na=False handles any potential empty/null rows gracefully\n","    matching_poems = poems_df[poems_df[text_column].str.contains(regex_pattern, regex=True, na=False)]\n","\n","    #Select a response\n","    if not matching_poems.empty:\n","        # we found at least one match. Lets pick one randomly.\n","        random_poem_row = matching_poems.sample(1).iloc[0]\n","        \n","        misra1 = random_poem_row['misra1']\n","        misra2 = random_poem_row['misra2']\n","        poet_name = random_poem_row['poet']\n","        \n","        return f\"{misra1}\\n{misra2}\\n\\n- {poet_name}\"\n","    \n","    else:\n","        # If the DataFrame of matches is empty, we couldn't find a reply.\n","        return f\"Ø´Ø¹Ø±ÛŒ Ú©Ù‡ Ø¨Ø§ Ø§ÛŒÙ† Ø­Ø±Ù Ø´Ø±ÙˆØ¹ Ø´Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ú©Ø±Ø¯Ù… \"\n"]},{"cell_type":"code","execution_count":6,"id":"3212f5b2","metadata":{"execution":{"iopub.execute_input":"2025-11-11T13:14:16.324146Z","iopub.status.busy":"2025-11-11T13:14:16.323848Z","iopub.status.idle":"2025-11-11T13:14:16.438579Z","shell.execute_reply":"2025-11-11T13:14:16.437485Z"},"papermill":{"duration":0.119332,"end_time":"2025-11-11T13:14:16.440098","exception":false,"start_time":"2025-11-11T13:14:16.320766","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["--- ğŸ¤– Chatbot Moshare ÙØ¹Ø§Ù„ Ø´Ø¯ ---\n","ÛŒÚ© Ø¨ÛŒØª Ø´Ø¹Ø± Ø¨ÙØ±Ø³ØªÛŒØ¯ ØªØ§ Ø¨Ø§ Ø¨ÛŒØª Ø¨Ø¹Ø¯ÛŒ Ù¾Ø§Ø³Ø® Ø¯Ù‡Ù….\n","Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ØŒ Ø¹Ø¨Ø§Ø±Øª 'Ø®Ø±ÙˆØ¬' Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯.\n","--------------------\n","DEBUG: User's last letter is 'ÛŒ'. Searching for a reply...\n","\n","Ø±Ø¨Ø§Øª: ÛŒÚ© Ø¯Ù…Ù… Ú†Ø´Ù…Ù‡ Ø®ÙˆØ±Ø´ÛŒØ¯ Ú©Ù†Ø¯\n","ÛŒÚ© Ø¯Ù…ÛŒ Ø¬Ù…Ù„Ù‡ Ø´Ø¨Ø³ØªØ§Ù† Ú©Ù†Ø¯Ù…\n","\n","- Mowlana\n","\n","--------------------\n","DEBUG: User's last letter is 'ÛŒ'. Searching for a reply...\n","\n","Ø±Ø¨Ø§Øª: ÛŒÚ© Ø²Ù†ÛŒ Ø¨Ø§ Ø·ÙÙ„ Ø¢ÙˆØ±Ø¯ Ø¢Ù† Ø¬Ù‡ÙˆØ¯\n","Ù¾ÛŒØ´ Ø¢Ù† Ø¨ØªØŒ Ø¢ØªØ´ Ø§Ù†Ø¯Ø± Ø´Ø¹Ù„Ù‡ Ø¨ÙˆØ¯\n","\n","- Mowlana\n","\n","--------------------\n","DEBUG: User's last letter is 'ÛŒ'. Searching for a reply...\n","\n","Ø±Ø¨Ø§Øª: ÛŒØ§ Ø´ÙˆÙ‚ Ø§ÛŒÙ† Ø§Ù„Ø¹Ø§ÙÛŒÙ‡ Ú©ÛŒ Ø§Ø¶Ø·ÙØ± Ø¨Ø§Ù„Ù‚Ø§ÙÛŒÙ‡\n","Ø¹Ù†Ø¯ÛŒ ØµÙØ§Øª ØµØ§ÙÛŒÙ‡ ÙÛŒ Ø¬Ù†Ø¨Ù‡Ø§ Ù†Ø·Ù‚ÛŒ Ú©Ø¯Ø±\n","\n","- Mowlana\n","\n","--------------------\n"]}],"source":["#!! VERY IMPORTANT !! Change 'poem' to the actual name of your poem column.\n","POEM_COLUMN_NAME = 'misra1' #  REPLACE 'poem' WITH YOUR ACTUAL COLUMN NAME. later I have to make a mechanism to change poet with it\n","\n","\n","\n","print(\"--- ğŸ¤– Chatbot Moshare ÙØ¹Ø§Ù„ Ø´Ø¯ ---\")\n","print(\"ÛŒÚ© Ø¨ÛŒØª Ø´Ø¹Ø± Ø¨ÙØ±Ø³ØªÛŒØ¯ ØªØ§ Ø¨Ø§ Ø¨ÛŒØª Ø¨Ø¹Ø¯ÛŒ Ù¾Ø§Ø³Ø® Ø¯Ù‡Ù….\")\n","print(\"Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ØŒ Ø¹Ø¨Ø§Ø±Øª 'Ø®Ø±ÙˆØ¬' Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯.\")\n","print(\"-\" * 20)\n","\n","n = 0 \n","while (n<3):\n","    try:\n","        user_poem = (\"Ø¨Ø§ Ù„Ø¨ Ø¯Ù…Ø³Ø§Ø² Ø®ÙˆØ¯ Ú¯Ø±Ø¬ÙØªÙ…ÛŒ\")\n","        # this is for running env kaggle. in the final project, we can get input from the user, but here I want to run it on Kaggle. Kaggle does not recognize this. \n","        \n","        if user_poem.strip() in [\"Ø®Ø±ÙˆØ¬\", \"exit\", \"quit\"]:\n","            print(\"Ø®ÙˆØ´Ø­Ø§Ù„ Ø§Ø² Ù‡Ù… ØµØ­Ø¨ØªÛŒ Ø¨Ø§ Ø´Ù…Ø§. Ø®Ø¯Ø§Ù†Ú¯Ù‡Ø¯Ø§Ø±!\")\n","            break\n","            \n","        # Call our main function to get the bot's response\n","        bot_reply = find_reply_poem(user_poem, all_poems_df, POEM_COLUMN_NAME)\n","        \n","        print(f\"\\nØ±Ø¨Ø§Øª: {bot_reply}\\n\")\n","        print(\"-\" * 20)\n","        n = n +1  \n","    except (KeyboardInterrupt, EOFError):\n","        # Handle Ctrl+C or end-of-input gracefully\n","        print(\"\\nØ®Ø¯Ø§ Ù†Ú¯Ù‡Ø¯Ø§Ø±!\")\n","        break\n"]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[{"datasetId":8682116,"sourceId":13656357,"sourceType":"datasetVersion"},{"datasetId":8682151,"sourceId":13656402,"sourceType":"datasetVersion"}],"dockerImageVersionId":31192,"isGpuEnabled":false,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.11.13"},"papermill":{"default_parameters":{},"duration":7.863986,"end_time":"2025-11-11T13:14:16.861843","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2025-11-11T13:14:08.997857","version":"2.6.0"}},"nbformat":4,"nbformat_minor":5}