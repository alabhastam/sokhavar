{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/aabdollahii/sokhanvar-pt2?scriptVersionId=276044223\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"code","execution_count":1,"id":"1c132a92","metadata":{"execution":{"iopub.execute_input":"2025-11-11T14:14:11.30794Z","iopub.status.busy":"2025-11-11T14:14:11.307617Z","iopub.status.idle":"2025-11-11T14:14:13.893862Z","shell.execute_reply":"2025-11-11T14:14:13.892905Z"},"papermill":{"duration":2.591877,"end_time":"2025-11-11T14:14:13.895545","exception":false,"start_time":"2025-11-11T14:14:11.303668","status":"completed"},"tags":[]},"outputs":[],"source":["import pandas as pd\n","import os\n","\n","\n","molana_file_path = '/kaggle/input/molana-poems-csv/.csv' # <-- CHECK THIS FILENAME\n","saadi_file_path = '/kaggle/input/saadi-poems-csv/(1).csv'\n","\n","molana_df = pd.read_csv(molana_file_path)\n","saadi_df = pd.read_csv(saadi_file_path)\n"]},{"cell_type":"code","execution_count":2,"id":"e322c893","metadata":{"execution":{"iopub.execute_input":"2025-11-11T14:14:13.901466Z","iopub.status.busy":"2025-11-11T14:14:13.901148Z","iopub.status.idle":"2025-11-11T14:14:13.917212Z","shell.execute_reply":"2025-11-11T14:14:13.91627Z"},"papermill":{"duration":0.020863,"end_time":"2025-11-11T14:14:13.918922","exception":false,"start_time":"2025-11-11T14:14:13.898059","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["โ Successfully combined both datasets.\n","Original column order: ['misra1', 'misra2', 'poet']\n"]}],"source":["# add a new column to combine all the poets together\n","\n","molana_df['poet'] = 'Mowlana'\n","saadi_df['poet'] = 'Saadi'\n","\n","all_poems_df = pd.concat([molana_df, saadi_df], ignore_index=True)\n","print(\"โ Successfully combined both datasets.\")\n","print(\"Original column order:\", all_poems_df.columns.tolist())"]},{"cell_type":"code","execution_count":3,"id":"28c1b17a","metadata":{"execution":{"iopub.execute_input":"2025-11-11T14:14:13.924468Z","iopub.status.busy":"2025-11-11T14:14:13.924167Z","iopub.status.idle":"2025-11-11T14:14:13.945658Z","shell.execute_reply":"2025-11-11T14:14:13.94471Z"},"papermill":{"duration":0.026367,"end_time":"2025-11-11T14:14:13.947445","exception":false,"start_time":"2025-11-11T14:14:13.921078","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>misra1</th>\n","      <th>misra2</th>\n","      <th>poet</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>ฺฉ ฺฏูุฌ ูพุฏุฏ ุขูุฏ ุฏุฑ ุขู ุฏฺฉุงู ุฒุฑฺฉูุจ</td>\n","      <td>ุฒู ุตูุฑุช ุฒู ูุนู ุฒู ุฎูุจ ุฒู ุฎูุจ</td>\n","      <td>Mowlana</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>ุฒู ุจุงุฒุงุฑ ุฒุฑฺฉูุจุงู ุฒู ุงุณุฑุงุฑ ุนููุจุงู</td>\n","      <td>ฺฉู ุฌุงู ูุณู ุงุฒ ุนุดูุด ุจุฑุขุฑุฏ ุดูุฑ ุนููุจ</td>\n","      <td>Mowlana</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>ุฒ ุนุดู ุงู ุฏู ุตุฏ ูู ฺู ูุฌููู ุจูุฏ ูโุฏุฑุฏ</td>\n","      <td>ฺฉุฒ ุงู ุขุชุด ุฒุจูู ุขุฏ ุตุจูุฑโูุง ุงูุจ</td>\n","      <td>Mowlana</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>ุดุฏู ุฒุฑฺฉูุจ ู ุญู ูุงูุฏู ุชูุด ฺูู ุฒุฑูุฑู ูุงูุฏู</td>\n","      <td>ุฌูุงูุฑ ุจุฑ ุทุจู ูุงูุฏู ฺู ุฒุฑฺฉูุจ ฺฉุฑูุจ</td>\n","      <td>Mowlana</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>ุจุง ุจููุงุฒ ุนุงุดู ุฑุง ฺฉู ุชู ุฌุงู ุญูุงู ุฑุง</td>\n","      <td>ุจุฒู ฺฏุฑุฏู ููุงูู ุฑุง ุงฺฏุฑ ุงุฒ ู ุจุงุดูุจ</td>\n","      <td>Mowlana</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                                     misra1  \\\n","0       ฺฉ ฺฏูุฌ ูพุฏุฏ ุขูุฏ ุฏุฑ ุขู ุฏฺฉุงู ุฒุฑฺฉูุจ   \n","1       ุฒู ุจุงุฒุงุฑ ุฒุฑฺฉูุจุงู ุฒู ุงุณุฑุงุฑ ุนููุจุงู   \n","2   ุฒ ุนุดู ุงู ุฏู ุตุฏ ูู ฺู ูุฌููู ุจูุฏ ูโุฏุฑุฏ   \n","3  ุดุฏู ุฒุฑฺฉูุจ ู ุญู ูุงูุฏู ุชูุด ฺูู ุฒุฑูุฑู ูุงูุฏู   \n","4     ุจุง ุจููุงุฒ ุนุงุดู ุฑุง ฺฉู ุชู ุฌุงู ุญูุงู ุฑุง   \n","\n","                                 misra2     poet  \n","0   ุฒู ุตูุฑุช ุฒู ูุนู ุฒู ุฎูุจ ุฒู ุฎูุจ  Mowlana  \n","1  ฺฉู ุฌุงู ูุณู ุงุฒ ุนุดูุด ุจุฑุขุฑุฏ ุดูุฑ ุนููุจ  Mowlana  \n","2   ฺฉุฒ ุงู ุขุชุด ุฒุจูู ุขุฏ ุตุจูุฑโูุง ุงูุจ  Mowlana  \n","3    ุฌูุงูุฑ ุจุฑ ุทุจู ูุงูุฏู ฺู ุฒุฑฺฉูุจ ฺฉุฑูุจ  Mowlana  \n","4   ุจุฒู ฺฏุฑุฏู ููุงูู ุฑุง ุงฺฏุฑ ุงุฒ ู ุจุงุดูุจ  Mowlana  "]},"execution_count":3,"metadata":{},"output_type":"execute_result"}],"source":["all_poems_df.head()"]},{"cell_type":"code","execution_count":4,"id":"c25a9e2f","metadata":{"execution":{"iopub.execute_input":"2025-11-11T14:14:13.954053Z","iopub.status.busy":"2025-11-11T14:14:13.953253Z","iopub.status.idle":"2025-11-11T14:14:13.995838Z","shell.execute_reply":"2025-11-11T14:14:13.994736Z"},"papermill":{"duration":0.047528,"end_time":"2025-11-11T14:14:13.997408","exception":false,"start_time":"2025-11-11T14:14:13.94988","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["<class 'pandas.core.frame.DataFrame'>\n","RangeIndex: 82194 entries, 0 to 82193\n","Data columns (total 3 columns):\n"," #   Column  Non-Null Count  Dtype \n","---  ------  --------------  ----- \n"," 0   misra1  82194 non-null  object\n"," 1   misra2  82194 non-null  object\n"," 2   poet    82194 non-null  object\n","dtypes: object(3)\n","memory usage: 1.9+ MB\n"]}],"source":["all_poems_df.info()"]},{"cell_type":"code","execution_count":5,"id":"6e9a196e","metadata":{"execution":{"iopub.execute_input":"2025-11-11T14:14:14.004023Z","iopub.status.busy":"2025-11-11T14:14:14.003674Z","iopub.status.idle":"2025-11-11T14:14:14.011154Z","shell.execute_reply":"2025-11-11T14:14:14.010149Z"},"papermill":{"duration":0.012728,"end_time":"2025-11-11T14:14:14.012686","exception":false,"start_time":"2025-11-11T14:14:13.999958","status":"completed"},"tags":[]},"outputs":[],"source":["import re\n","import random\n","\n","# this function is used for a program which is related to the Moshaere system (which has regex systems inside of it. There is another function for talking to user )\n","\n","\n","# words are already normalized \n","def find_reply_poem(user_input: str, poems_df: pd.DataFrame, text_column: str) -> str:\n","    \n","    \n","\n","    # Find the last valid Persian letter of the user's input\n","    last_letter = None\n","    for char in reversed(user_input):\n","        if re.match('[ุข-]', char):\n","            last_letter = char\n","            break # Stop as soon as we find the first valid letter from the end\n","\n","    if last_letter is None:\n","        return \"ูุชุงุณูุงูู ุญุฑู ููุงุณุจ ุจุฑุง ุดุฑูุน ุดุนุฑ ุจุนุฏ ุฏุฑ ูพุงู ุดูุง ูพุฏุง ูฺฉุฑุฏู. ูุทูุง ฺฉ ุจุช ุดุนุฑ ุจูุฑุณุชุฏ.\"\n","\n","    print(f\"DEBUG: User's last letter is '{last_letter}'. Searching for a reply...\")\n","\n","    # Build the regex pattern to find a poem starting with that letter\n","    #    ^ means \"start of the string\"\n","    regex_pattern = f\"^{last_letter}\"\n","\n","    # .str.contains() with regex=True is a powerful way to apply regex to a pandas column\n","    # na=False handles any potential empty/null rows gracefully\n","    matching_poems = poems_df[poems_df[text_column].str.contains(regex_pattern, regex=True, na=False)]\n","\n","    #Select a response\n","    if not matching_poems.empty:\n","        # we found at least one match. Lets pick one randomly.\n","        random_poem_row = matching_poems.sample(1).iloc[0]\n","        \n","        misra1 = random_poem_row['misra1']\n","        misra2 = random_poem_row['misra2']\n","        poet_name = random_poem_row['poet']\n","        \n","        return f\"{misra1}\\n{misra2}\\n\\n- {poet_name}\"\n","    \n","    else:\n","        # If the DataFrame of matches is empty, we couldn't find a reply.\n","        return f\"ุดุนุฑ ฺฉู ุจุง ุงู ุญุฑู ุดุฑูุน ุดู ูพุฏุง ูฺฉุฑุฏู \"\n"]},{"cell_type":"code","execution_count":6,"id":"4fbd4162","metadata":{"execution":{"iopub.execute_input":"2025-11-11T14:14:14.018722Z","iopub.status.busy":"2025-11-11T14:14:14.018434Z","iopub.status.idle":"2025-11-11T14:14:14.02368Z","shell.execute_reply":"2025-11-11T14:14:14.022907Z"},"papermill":{"duration":0.010056,"end_time":"2025-11-11T14:14:14.025195","exception":false,"start_time":"2025-11-11T14:14:14.015139","status":"completed"},"tags":[]},"outputs":[],"source":["def handle_conversation(user_input: str) -> str:\n","    patterns = {\n","        r\"(ุณูุงู|ุฏุฑูุฏ|ููุช ุจุฎุฑ)\": \"ุณูุงู! ฺู ฺฉูฺฉ ุงุฒ ุฏุณุช ูู ุจุฑ ูุงุฏุ\",\n","        r\"(ฺุทูุฑ|ุฎูุจ|ฺู ุฎุจุฑ)\": \"ูููููุ ูู ฺฉ ุจุฑูุงูู ฺฉุงููพูุชุฑ ูุณุชู ู ุญุงูู ููุดู ุฎูุจู. ุดูุง ฺุทูุฑุฏุ\",\n","        r\"(ุชู ฺฉ ูุณุช|ุงุณูุช ฺู)\": \"ูู ฺฉ ุฑุจุงุช ูุดุงุนุฑู ูุณุชู ฺฉู ุจุฑ ุงุณุงุณ ุงุดุนุงุฑ ูููุงูุง ู ุณุนุฏ ุณุงุฎุชู ุดุฏูโุงู.\",\n","        r\"(ฺฺฉุงุฑ ูฺฉู|ฺู ฺฉุงุฑ ูฺฉู)\": \"ูู ุจุฑุง ูุดุงุนุฑู ุณุงุฎุชู ุดุฏูโุงู. ุดูุง ฺฉ ุจุช ุดุนุฑ ุจูุฑุณุชุฏ ุชุง ูู ุจุง ุจุช ุจุนุฏ ูพุงุณุฎ ุฏูู.\"\n","    }\n","\n","    for pattern, response in patterns.items():\n","        if re.search(pattern, user_input):\n","            return response\n","\n","    return \"ูุชูุฌู ููุธูุฑุชูู ูุดุฏู. ุงฺฏุฑ ูโุฎูุงูุฏ ูุดุงุนุฑู ฺฉููุ ูุทูุง ฺฉ ุจุช ุดุนุฑ ุจูุฑุณุชุฏ.\"\n"]},{"cell_type":"code","execution_count":7,"id":"5cc5f977","metadata":{"execution":{"iopub.execute_input":"2025-11-11T14:14:14.031442Z","iopub.status.busy":"2025-11-11T14:14:14.031116Z","iopub.status.idle":"2025-11-11T14:14:14.039873Z","shell.execute_reply":"2025-11-11T14:14:14.038743Z"},"papermill":{"duration":0.013595,"end_time":"2025-11-11T14:14:14.041258","exception":false,"start_time":"2025-11-11T14:14:14.027663","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["--- ๐ค Chatbot Moshare ูุนุงู ุดุฏ ---\n","ฺฉ ุจุช ุดุนุฑ ุจูุฑุณุชุฏ ุชุง ุจุง ุจุช ุจุนุฏ ูพุงุณุฎ ุฏูู.\n","ุงฺฏุฑ ูุฎูุงู ูุดุงุนุฑู ฺฉูู ูุทูุง ุงุฒ ุนูุงุฆู ูฺฏุงุฑุด ุงุณุชูุงุฏู ูฺฉู ุญุช ุงุฒ ููุทู\n","ุงฺฏุฑ ูุฎูุงู ุตุญุจุช ฺฉูู ุงุฏุช ุจุงุดู ุจุงุฏ ุงุฒ ุนูุงุฆู ูฺฏุงุฑุด ุงุณุชูุงุฏู ฺฉู\n","ุจุฑุง ุฎุฑูุฌุ ุนุจุงุฑุช 'ุฎุฑูุฌ' ุฑุง ุชุงูพ ฺฉูุฏ.\n","--------------------\n","\n","ุฑุจุงุช: ูู ฺฉ ุฑุจุงุช ูุดุงุนุฑู ูุณุชู ฺฉู ุจุฑ ุงุณุงุณ ุงุดุนุงุฑ ูููุงูุง ู ุณุนุฏ ุณุงุฎุชู ุดุฏูโุงู.\n","\n","--------------------\n","\n","ุฑุจุงุช: ูู ฺฉ ุฑุจุงุช ูุดุงุนุฑู ูุณุชู ฺฉู ุจุฑ ุงุณุงุณ ุงุดุนุงุฑ ูููุงูุง ู ุณุนุฏ ุณุงุฎุชู ุดุฏูโุงู.\n","\n","--------------------\n","\n","ุฑุจุงุช: ูู ฺฉ ุฑุจุงุช ูุดุงุนุฑู ูุณุชู ฺฉู ุจุฑ ุงุณุงุณ ุงุดุนุงุฑ ูููุงูุง ู ุณุนุฏ ุณุงุฎุชู ุดุฏูโุงู.\n","\n","--------------------\n"]}],"source":["#!! VERY IMPORTANT !! Change 'poem' to the actual name of your poem column.\n","POEM_COLUMN_NAME = 'misra1' #  REPLACE 'poem' WITH YOUR ACTUAL COLUMN NAME. later I have to make a mechanism to change poet with it\n","\n","\n","\n","print(\"--- ๐ค Chatbot Moshare ูุนุงู ุดุฏ ---\")\n","print(\"ฺฉ ุจุช ุดุนุฑ ุจูุฑุณุชุฏ ุชุง ุจุง ุจุช ุจุนุฏ ูพุงุณุฎ ุฏูู.\")\n","print(\"ุงฺฏุฑ ูุฎูุงู ูุดุงุนุฑู ฺฉูู ูุทูุง ุงุฒ ุนูุงุฆู ูฺฏุงุฑุด ุงุณุชูุงุฏู ูฺฉู ุญุช ุงุฒ ููุทู\")\n","print(\"ุงฺฏุฑ ูุฎูุงู ุตุญุจุช ฺฉูู ุงุฏุช ุจุงุดู ุจุงุฏ ุงุฒ ุนูุงุฆู ูฺฏุงุฑุด ุงุณุชูุงุฏู ฺฉู\")\n","print(\"ุจุฑุง ุฎุฑูุฌุ ุนุจุงุฑุช 'ุฎุฑูุฌ' ุฑุง ุชุงูพ ฺฉูุฏ.\")\n","print(\"-\" * 20)\n","\n","n = 0 \n","while (n<3):\n","    try:\n","        user_input = (\"ุงุณูุช ฺูุ\")\n","        \n","        if user_input.strip().lower() in [\"ุฎุฑูุฌ\", \"exit\", \"quit\"]:\n","            print(\"ุฎูุดุญุงู ุงุฒ ูู ุตุญุจุช ุจุง ุดูุง. ุฎุฏุงูฺฏูุฏุงุฑ!\")\n","            break\n","\n","        \n","        # ุงฺฏุฑ ฺฉุงุฑุจุฑ ุงุฒ ุนูุงุฆู ุณูุงู ุง ุชุนุฌุจ ุงุณุชูุงุฏู ฺฉุฑุฏุ ูุงุฑุฏ ุญุงูุช ูฺฉุงููู ูโุดูู\n","        if 'ุ' in user_input or '!' in user_input:\n","            bot_reply = handle_conversation(user_input)\n","        else:\n","            # ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ูุฑุถ ูโฺฉูู ฺฉุงุฑุจุฑ ุฏุฑ ุญุงู ูุดุงุนุฑู ุงุณุช\n","            bot_reply = find_reply_poem(user_input, all_poems_df, POEM_COLUMN_NAME)\n","        # === ูพุงุงู ููุทู ุชุตููโฺฏุฑ ===\n","        \n","        print(f\"\\nุฑุจุงุช: {bot_reply}\\n\")\n","        print(\"-\" * 20)\n","        n = n + 1\n","\n","    except (KeyboardInterrupt, EOFError):\n","        print(\"\\nุฎุฏุง ูฺฏูุฏุงุฑ!\")\n","        break\n","    except Exception as e:\n","        print(f\"ฺฉ ุฎุทุง ุบุฑููุชุธุฑู ุฑุฎ ุฏุงุฏ: {e}\")\n","        break"]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[{"datasetId":8682116,"sourceId":13656357,"sourceType":"datasetVersion"},{"datasetId":8682151,"sourceId":13656402,"sourceType":"datasetVersion"}],"dockerImageVersionId":31192,"isGpuEnabled":false,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.11.13"},"papermill":{"default_parameters":{},"duration":8.326249,"end_time":"2025-11-11T14:14:14.563741","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2025-11-11T14:14:06.237492","version":"2.6.0"}},"nbformat":4,"nbformat_minor":5}